<% full_view ||= false %>

<article class="project <%= "shortlisted" if project.shortlisted_by?(current_user) %> <%= "winner" if project.winner? %>" id="project<%= project.id %>" data-id="<%= project.id %>">
  <header>
    <div class="title">
      <%= link_to project.title, chapter_project_path(project.chapter, project), :class => "title" %></a>
      <% if current_user.can_mark_winner?(project) %>
        <%= show_winner_buttons_for(project) %>
      <% end %>
      <% unless project.hidden? %>
        <% if project.shortlisted_by?(current_user) %>
          <%= link_to t(".awesome"), project_vote_path(project), :method => :delete, :remote => true, :class => "short-list" %>
        <% else %>
          <%= link_to t(".awesome"), project_vote_path(project), :method => :post, :remote => true, :class => "short-list" %>
        <% end %>
      <% end %>
    </div>

    <% if full_view || !project.hidden? %>
      <section class="meta-data">
        <%= project.created_at %> (<%= project.chapter.name %>)

        <% if project.winner? %>
          路 <%= link_to t(".view-public-page"), project_path(project), :target => "blank" %>
        <% end %>

        <% if current_user.can_edit_project?(project) -%>
          <span class="spam">
            <%= link_to t(".delete"), project_path(project), :method => :delete, :data => { :confirm => t(".confirm-delete") }, :class => 'delete-spam' %>
          </span>
        <% end -%>
      </section>

      <section class="contact">
        <span>
          <%= project.name %>
        </span>

        <span>
          路 <%= mail_to project.email %>
        </span>

        <% if project.phone.present? %>
          <span>
            路 <%= project.phone %>
          </span>
        <% end %>

        <% if project.url.present? %>
          <span>
            路 <%= link_to project.url, project.url %>
          </span>
        <% end %>
      </section>
    </header>

    <section class="project-proposal-details">
      <div class="project-pitch">
        <% if project.has_images? %>
          <h3><%= t ".images" %></h3>
          <p class="gallery">
          <% project.photos.each_with_index do |image, index| %>
            <%= link_to t(".image", :index => index+1), image.url, :rel => "project-#{project.id}-images", :class => "lightbox", :target => "blank" %>
          <% end %>
          </p>
        <% end %>

        <h3><%= t ".about-project" %></h3>
        <%= markdown project.about_project %>
        <h3><%= t ".use-for-money" %></h3>
        <%= markdown project.use_for_money %>
        <h3><%= t ".about-me" %></h3>
        <%= markdown project.about_me %>

        <% 1.upto(Chapter::EXTRA_QUESTIONS_COUNT) do |num| -%>
          <% if project.extra_question(num).present? %>
            <h3><%= project.extra_question(num) %></h3>
            <%= markdown project.extra_answer(num) || "_#{t '.not-answered'}_" %>
          <% end %>
        <% end %>
      </div>

      <div class="details-toggle">
      </div>
      <%= link_to edit_project_path(project), :class => "see-more" do %>
        <p><%= t ".edit" %></p>
      <% end %>
    </section>

    <section class="filtering">
      <% if project.hidden? %>
        <div>
          <%= t(".hidden-details", username: project.hidden_by_user.name, on: l(project.hidden_at), because: project.hidden_reason) %>
        </div>
        <div class="unhiding-form">
          <%= button_to t(".unhide"), unhide_project_path(id: project.id), method: :put, class: "hide-action" %>
        </div>
      <% else %>
        <div class="consider-hiding">
          <%= t(".consider-hiding") %>
          <%= link_to t(".hide"), "#", data: {"project-id" => project.id}, class: "hideFormLink" %>
        </div>
        <div class="hiding-form">
          <%= form_tag hide_project_path(project), method: :put do %>
            <%= t(".hide-reason") %>
            <%= text_field_tag :hidden_reason, "", class: "reason" %>
            <%= submit_tag t(".hide"), class: "hide-action" %>
          <% end %>
          <div class="explanation">
            Hiding a project will hide its details from everyone; the title and why it was hidden will still be visible, and it can be easily unhidden.
          </div>
        </div>
      <% end %>
    </section>
  <% end %>
</article>
